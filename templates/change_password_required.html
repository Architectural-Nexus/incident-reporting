{% extends "base.html" %}

{% block title %}Change Password Required - Incident Reporting System{% endblock %}

{% block content %}
<div style="max-width: 400px; margin: 0 auto;">
    <div class="card">
        <h1 style="margin-bottom: 1.5rem; color: var(--text-primary); text-align: center;">Change Password Required</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div style="margin-bottom: 1rem;">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        <p style="margin-bottom: 1.5rem; text-align: center; color: var(--text-secondary);">
            Welcome {{ current_user.username }}! You must change your temporary password before accessing the system.
        </p>

        <form method="POST">
            <div class="form-group">
                <label for="password" class="form-label">New Password</label>
                <div style="position: relative;">
                    <input type="password" id="password" name="password" class="form-input" required autofocus minlength="6" style="padding-right: 3rem;">
                    <button type="button" onclick="togglePassword('password')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-secondary); font-size: 1rem;" title="Show/Hide Password">
                        <span id="password-toggle">üëÅÔ∏è</span>
                    </button>
                </div>
                <small style="color: var(--text-secondary); font-size: 0.875rem;">Minimum 6 characters</small>
            </div>

            <div class="form-group">
                <label for="confirm_password" class="form-label">Confirm New Password</label>
                <div style="position: relative;">
                    <input type="password" id="confirm_password" name="confirm_password" class="form-input" required minlength="6" style="padding-right: 3rem;">
                    <button type="button" onclick="togglePassword('confirm_password')" style="position: absolute; right: 0.75rem; top: 50%; transform: translateY(-50%); background: none; border: none; cursor: pointer; color: var(--text-secondary); font-size: 1rem;" title="Show/Hide Password">
                        <span id="confirm_password-toggle">üëÅÔ∏è</span>
                    </button>
                </div>
            </div>

            <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">Change Password</button>
        </form>

        <div style="margin-top: 1.5rem; padding: 1rem; background-color: var(--background-color); border-radius: 0.5rem; border-left: 4px solid var(--primary-color);">
            <h4 style="margin: 0 0 0.5rem 0; color: var(--text-primary); font-size: 0.875rem;">Security Requirements:</h4>
            <ul style="margin: 0; padding-left: 1rem; color: var(--text-secondary); font-size: 0.875rem;">
                <li>Password must be at least 6 characters long</li>
                <li>Choose a strong, unique password</li>
                <li>Do not share your password with others</li>
            </ul>
        </div>
    </div>
</div>

<script>
function togglePassword(fieldId) {
    const passwordField = document.getElementById(fieldId);
    const toggleButton = document.getElementById(fieldId + '-toggle');
    
    if (passwordField.type === 'password') {
        passwordField.type = 'text';
        toggleButton.textContent = 'üôà';
        toggleButton.title = 'Hide Password';
    } else {
        passwordField.type = 'password';
        toggleButton.textContent = 'üëÅÔ∏è';
        toggleButton.title = 'Show Password';
    }
}

// Add password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;
    
    if (password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value) {
        if (this.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity('Passwords do not match');
        } else {
            confirmPassword.setCustomValidity('');
        }
    }
});
</script>
{% endblock %}
